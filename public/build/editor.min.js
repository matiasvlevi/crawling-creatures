/*!
 genetic-creatures v1.0.0 by Matias Vazquez-Levi 
 Build date: 2022-08-29
 License: MIT
*/
class Server{constructor(){}static async http({ip:e,port:t,path:i,method:s,body:o}){return fetch(`http://${e}:${t}/${i}`,{method:s,body:void 0===o?void 0:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e.json()))}}class Spawnpoint{constructor(e,{x:t,y:i}){this.world=e,this.pos=createVector(t,i),this.attributes={label:"Spawnpoint"}}static draw(e,t){push(),stroke(255,100),strokeWeight(3),noFill(),circle(e,t,260),noStroke(),fill(255,100),circle(e,t,32),pop()}draw(){push(),stroke(255,50,10),strokeWeight(3),noFill(),circle(this.pos.x,this.pos.y,260),noStroke(),fill(255,50,10),circle(this.pos.x,this.pos.y,32),pop()}}class Editor{constructor(){this.window={x:window.innerWidth,y:window.innerHeight},this.space={x:this.window.x/1.2,y:this.window.y/1.2},this.engine=Matter.Engine.create(),this.world=this.engine.world,this.placement={body:Editor.bodies.Block,size:createVector(32,32),gridSize:32},this.previous={mouseX:0,mouseY:0},this.toggleOptions={grid:!0,snap:!1},this.sideMenu={distance:1800,mutationRate:1.5,firstPopulation:128,population:64,roundTime:2e3},this.bodies=[],this.release=!0,this._timer=0,this._cooldown=10,this.spawnExists=!1}static bodies={Block:{Component:Block,shape:function(){rect(...arguments)},config:(e,t)=>({x:e.mouse().x,y:e.mouse().y,w:t.x,h:t.y,color:"#222"}),parse:e=>({x:1.2*e.body.position.x,y:1.2*e.body.position.y,w:1.2*e.attributes.w,h:1.2*e.attributes.h,type:e.body.label.split(" ")[0]})},Ball:{Component:Ball,shape:function(){ellipse(...arguments)},config:(e,t)=>({x:e.mouse().x,y:e.mouse().y,r:t.x/2,color:"#222"}),parse:e=>({x:1.2*e.body.position.x,y:1.2*e.body.position.y,r:1.2*e.attributes.r,type:e.body.label.split(" ")[0]})},Spawnpoint:{Component:Spawnpoint,shape:function(){Spawnpoint.draw(...arguments)},config:e=>(e.spawnExists=!0,{x:1.2*e.mouse().x,y:1.2*e.mouse().y}),parse:e=>({x:e.pos.x,y:e.pos.y,type:"Spawnpoint"})}};getData(){let e=document.querySelector("#simulationName").value,t=document.querySelector("#simulationDescription").value;return{bodies:this.bodies.map((e=>Editor.bodies[e.constructor.name].parse(e))),meta:{description:0!==t.length?t:"No Description",name:0!==e.length?e:"No Name"},metrics:{firstPopulation:document.querySelector("#firstPopulation").value,population:document.querySelector("#population").value,distance:document.querySelector("#distance").value,roundTime:document.querySelector("#roundTime").value,mutationRate:document.querySelector("#mutationRate").value}}}sendSimulationData(){Server.http({ip:"127.0.0.1",port:"3000",path:"saveSimulation",method:"post",body:this.getData()})}setSideMenuValue(e,t){this.sideMenu[e]=t}setType(e){this.placement.size.x=this.placement.gridSize,this.placement.size.y=this.placement.gridSize,void 0!==Editor.bodies[e]&&(this.placement.body=Editor.bodies[e])}setSnapSize(e){this.placement.size.x=e,this.placement.size.y=e,this.placement.gridSize=e}toggle(e){this.toggleOptions[e]=!this.toggleOptions[e]}scaleBody(e,t){this.placement.size[e]>=this.placement.gridSize?this.placement.size[e]+=abs(t)/t*this.placement.gridSize*2:this.placement.size[e]=this.placement.gridSize}mouseWheel(e){let t=e.delta/45;keyIsPressed&&"Ball"!=this.placement.body.Component.name?89===keyCode?this.scaleBody("y",t):88===keyCode&&this.scaleBody("x",t):(this.scaleBody("y",t),this.scaleBody("x",t))}event(){if(mouseIsPressed&&this._timer>this._cooldown&&this.previous.mouseX!==mouseX&&this.previous.mouseY!==mouseY&&this.mouse().x<this.space.x&&this.mouse().y<this.space.y){if(this.placement.body.Component===Spawnpoint&&this.spawnExists){for(key in this.bodies)if(this.bodies[key]instanceof Spawnpoint){this.bodies[key].pos.x=this.mouse().x,this.bodies[key].pos.y=this.mouse().y;break}}else this.bodies.push(new this.placement.body.Component(this.world,this.placement.body.config(this,this.placement.size)));this.previous.mouseX=this.mouse().x,this.previous.mouseY=this.mouse().y,this._timer=0}else this._timer++}mouse(){return{x:this.toggleOptions.snap?round(mouseX/this.placement.gridSize)*this.placement.gridSize+this.placement.gridSize/2:mouseX,y:this.toggleOptions.snap?round(mouseY/this.placement.gridSize)*this.placement.gridSize+this.placement.gridSize/2:mouseY}}draw(){push(),this.toggleOptions.grid&&this.drawGrid(),this.bodies.forEach((e=>{e.draw()})),fill(255,100),noStroke(),rectMode(CENTER),this.placement.body.shape(this.mouse().x,this.mouse().y,this.placement.size.x,this.placement.size.y),pop(),stroke(255,0,0),strokeWeight(2),line(this.sideMenu.distance/1.2,0,this.sideMenu.distance/1.2,this.space.y),stroke(0),noFill(),rect(0,0,this.space.x,this.space.y),noStroke(),fill(51),rect(this.space.x,0,this.window.x-this.space.x,this.window.y),rect(0,this.space.y,this.window.x,this.window.y-this.space.y)}drawGrid(){push(),stroke(60,60,60);for(let e=0;e<this.window.x/this.placement.gridSize;e++)line(e*this.placement.gridSize,0,e*this.placement.gridSize,this.window.y);for(let e=0;e<this.window.y/this.placement.gridSize;e++)line(0,e*this.placement.gridSize,this.window.x,e*this.placement.gridSize);pop()}}function mouseWheel(e){editor.mouseWheel(e)}function mousePressed(){event.released=!1}function mouseReleased(){event.released=!0}let editor;function setup(){editor=new Editor,createCanvas(editor.window.x,editor.window.y)}function draw(){background(51),editor.event(),editor.draw()}